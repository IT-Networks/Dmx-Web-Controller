<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>DMX Web Controller Pro</title>
    <link rel="stylesheet" href="style.css">
    <!-- Three.js for 3D rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div class="app">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 32 32">
                        <circle cx="16" cy="16" r="14" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 16 L16 12 L20 16 L16 20 Z" fill="currentColor"/>
                    </svg>
                    <span>DMX Pro</span>
                </div>
            </div>

            <div class="sidebar-menu">
                <button class="menu-item active" data-tab="devices" onclick="app.switchTab('devices')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <rect x="3" y="3" width="14" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="10" r="3" fill="currentColor"/>
                    </svg>
                    <span>Ger√§te</span>
                </button>

                <button class="menu-item" data-tab="interfaces" onclick="app.switchTab('interfaces')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <rect x="2" y="6" width="16" height="8" rx="1" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="6" cy="10" r="1.5" fill="currentColor"/>
                        <circle cx="10" cy="10" r="1.5" fill="currentColor"/>
                        <circle cx="14" cy="10" r="1.5" fill="currentColor"/>
                        <line x1="2" y1="2" x2="6" y2="6" stroke="currentColor" stroke-width="1.5"/>
                        <line x1="18" y1="2" x2="14" y2="6" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Interfaces</span>
                </button>

                <button class="menu-item" data-tab="groups" onclick="app.switchTab('groups')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <circle cx="7" cy="7" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="13" cy="7" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="14" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Gruppen</span>
                </button>

                <button class="menu-item" data-tab="scenes" onclick="app.switchTab('scenes')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path d="M3 3 L17 3 L17 17 L3 17 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M7 3 L7 17 M12 3 L12 17 M3 7 L17 7 M3 12 L17 12" stroke="currentColor" stroke-width="1"/>
                    </svg>
                    <span>Szenen</span>
                </button>

                <button class="menu-item" data-tab="effects" onclick="app.switchTab('effects')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path d="M10 3 L13 10 L10 17 L7 10 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="10" r="2" fill="currentColor"/>
                    </svg>
                    <span>Effekte</span>
                </button>

                <button class="menu-item" data-tab="sequences" onclick="app.switchTab('sequences')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <rect x="2" y="7" width="4" height="6" fill="currentColor"/>
                        <rect x="8" y="4" width="4" height="12" fill="currentColor"/>
                        <rect x="14" y="6" width="4" height="8" fill="currentColor"/>
                    </svg>
                    <span>Timeline</span>
                </button>

                <button class="menu-item" data-tab="stage" onclick="app.switchTab('stage')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path d="M2 14 L2 18 L18 18 L18 14 Z" fill="currentColor" opacity="0.3"/>
                        <circle cx="5" cy="8" r="1.5" fill="currentColor"/>
                        <path d="M5 8 L4 14" stroke="currentColor" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="10" cy="6" r="1.5" fill="currentColor"/>
                        <path d="M10 6 L10 14" stroke="currentColor" stroke-width="1.5" opacity="0.6"/>
                        <circle cx="15" cy="8" r="1.5" fill="currentColor"/>
                        <path d="M15 8 L16 14" stroke="currentColor" stroke-width="1.5" opacity="0.6"/>
                    </svg>
                    <span>B√ºhne</span>
                </button>

                <button class="menu-item" data-tab="settings" onclick="app.switchTab('settings')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <circle cx="10" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M10 2 L10 4 M10 16 L10 18 M2 10 L4 10 M16 10 L18 10 M4.9 4.9 L6.4 6.4 M13.6 13.6 L15.1 15.1 M15.1 4.9 L13.6 6.4 M6.4 13.6 L4.9 15.1" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Einstellungen</span>
                </button>
            </div>

            <div class="sidebar-footer">
                <div class="connection-status" id="connectionStatus">
                    <div class="status-indicator"></div>
                    <span>Verbunden</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-title">
                    <h1 id="pageTitle">Ger√§te</h1>
                    <p id="pageSubtitle">Verwalte deine DMX-Ger√§te</p>
                </div>
                <div class="header-actions" id="headerActions">
                    <button class="btn btn-primary" id="addButton" onclick="app.showAddDevice()">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <path d="M10 3 L10 17 M3 10 L17 10" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Ger√§t hinzuf√ºgen</span>
                    </button>
                </div>
            </header>

            <!-- Tab Contents -->
            <div class="tab-content active" id="devicesTab">
                <div class="content-grid" id="devicesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <circle cx="32" cy="32" r="28" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Ger√§te vorhanden</h3>
                        <p>F√ºge dein erstes DMX-Ger√§t hinzu</p>
                    </div>
                </div>
                <div class="blackout-controls" style="margin-top: 20px; padding: 20px; background: var(--card-bg); border-radius: 12px; display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-danger" onclick="app.blackout(false)" style="flex: 1; max-width: 200px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" style="margin-right: 8px;">
                            <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            <path d="M6 6 L14 14 M14 6 L6 14" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Blackout (Instant)
                    </button>
                    <button class="btn btn-secondary" onclick="app.blackout(true)" style="flex: 1; max-width: 200px;">
                        <svg width="20" height="20" viewBox="0 0 20 20" style="margin-right: 8px;">
                            <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2" opacity="0.5"/>
                            <path d="M10 2 L10 10" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Blackout (Fade 2s)
                    </button>
                </div>
            </div>

            <div class="tab-content" id="interfacesTab">
                <div class="content-grid" id="interfacesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <rect x="8" y="20" width="48" height="24" rx="2" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="20" cy="32" r="3" fill="currentColor" opacity="0.5"/>
                            <circle cx="32" cy="32" r="3" fill="currentColor" opacity="0.5"/>
                            <circle cx="44" cy="32" r="3" fill="currentColor" opacity="0.5"/>
                        </svg>
                        <h3>Keine Interfaces vorhanden</h3>
                        <p>Scanne nach Art-Net-Ger√§ten oder f√ºge manuell ein Interface hinzu</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="groupsTab">
                <div class="content-grid" id="groupsContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <circle cx="24" cy="24" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="40" cy="24" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="32" cy="44" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Gruppen vorhanden</h3>
                        <p>Erstelle eine Gruppe aus mehreren Ger√§ten</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="scenesTab">
                <div class="content-grid scenes-grid" id="scenesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <rect x="12" y="12" width="40" height="40" rx="4" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Szenen vorhanden</h3>
                        <p>Speichere die aktuelle Lichtstimmung als Szene</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="effectsTab">
                <div class="effects-layout">
                    <div class="effects-list" id="effectsContainer">
                        <div class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 64 64">
                                <path d="M32 12 L40 32 L32 52 L24 32 Z" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            </svg>
                            <h3>Keine Effekte vorhanden</h3>
                            <p>Erstelle deinen ersten Lichteffekt</p>
                        </div>
                    </div>
                    <div class="effects-sidebar">
                        <h3>Verf√ºgbare Effekte</h3>
                        <div class="effect-templates">
                            <button class="effect-template" onclick="app.createEffect('strobe')">
                                <span class="effect-icon">‚ö°</span>
                                <span>Stroboskop</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('rainbow')">
                                <span class="effect-icon">üåà</span>
                                <span>Regenbogen</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('chase')">
                                <span class="effect-icon">üîÑ</span>
                                <span>Lauflicht</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('pulse')">
                                <span class="effect-icon">üíì</span>
                                <span>Pulsieren</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('color_fade')">
                                <span class="effect-icon">üé®</span>
                                <span>Farbwechsel</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('fire')">
                                <span class="effect-icon">üî•</span>
                                <span>Feuer</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('lightning')">
                                <span class="effect-icon">‚ö°Ô∏è</span>
                                <span>Blitz</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('scanner')">
                                <span class="effect-icon">üî¶</span>
                                <span>Scanner</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('matrix')">
                                <span class="effect-icon">üìä</span>
                                <span>Matrix</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('twinkle')">
                                <span class="effect-icon">‚ú®</span>
                                <span>Glitzer</span>
                            </button>
                            <button class="effect-template effect-template-custom" onclick="app.openVisualDesigner()">
                                <span class="effect-icon">üé®</span>
                                <span>Custom Designer</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="sequencesTab">
                <div class="content-grid" id="sequencesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <rect x="8" y="24" width="12" height="16" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <rect x="26" y="16" width="12" height="32" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <rect x="44" y="20" width="12" height="24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Timeline vorhanden</h3>
                        <p>Erstelle eine Timeline-Sequence f√ºr automatisierte Abl√§ufe</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="settingsTab">
                <div class="settings-container">
                    <div class="settings-section">
                        <h2>‚öôÔ∏è Einstellungen</h2>

                        <!-- Server Connection Settings -->
                        <div class="settings-card">
                            <h3>üåê Server-Verbindung</h3>
                            <div class="form-group">
                                <label>Server-IP Adresse</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="serverIpInput" class="input" placeholder="192.168.1.100" style="flex: 1;">
                                    <button class="btn btn-secondary" onclick="app.searchServers()">
                                        üîç Suchen
                                    </button>
                                </div>
                                <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
                                    Aktuelle Server-IP: <strong id="currentServerIp">Auto (localhost)</strong>
                                </p>
                            </div>
                            <div class="form-group">
                                <div class="button-group">
                                    <button class="btn btn-primary" onclick="app.connectToServer()">
                                        üîå Verbinden
                                    </button>
                                    <button class="btn btn-secondary" onclick="app.testServerConnection()">
                                        üß™ Verbindung testen
                                    </button>
                                    <button class="btn btn-secondary" onclick="app.resetToLocalhost()">
                                        üè† Reset auf Localhost
                                    </button>
                                </div>
                            </div>
                            <div id="serverSearchResults" style="display: none; margin-top: 1rem;">
                                <label>Gefundene Server:</label>
                                <div id="serverList" class="server-list"></div>
                            </div>
                            <div id="serverConnectionStatus" style="margin-top: 1rem;">
                                <div class="info-row">
                                    <span>Verbindungsstatus:</span>
                                    <strong id="connectionStatusText" style="color: var(--text-muted)">Nicht verbunden</strong>
                                </div>
                            </div>
                        </div>

                        <!-- Audio Settings -->
                        <div class="settings-card">
                            <h3>üéµ Audio Control</h3>
                            <div class="form-group">
                                <div class="sound-status">
                                    <span id="settingsSoundStatus">Inaktiv</span>
                                </div>
                                <button class="btn btn-primary btn-block" id="settingsStartSoundBtn" onclick="app.toggleSound()">
                                    üé§ Audio aktivieren
                                </button>
                            </div>

                            <div id="settingsSoundLevelsDisplay" style="display: none;">
                                <div class="form-group">
                                    <label>Audio Level</label>
                                    <div class="level-meter">
                                        <div class="level-meter-bar">
                                            <div id="settingsSoundLevelBar" class="level-meter-fill"></div>
                                        </div>
                                        <span id="settingsSoundLevelText">0%</span>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Frequenzb√§nder</label>
                                    <div class="frequency-bars">
                                        <div class="freq-bar">
                                            <label>Bass</label>
                                            <div class="level-meter-bar">
                                                <div id="settingsLevelBass" class="level-meter-fill"></div>
                                            </div>
                                        </div>
                                        <div class="freq-bar">
                                            <label>Mid</label>
                                            <div class="level-meter-bar">
                                                <div id="settingsLevelMid" class="level-meter-fill"></div>
                                            </div>
                                        </div>
                                        <div class="freq-bar">
                                            <label>High</label>
                                            <div class="level-meter-bar">
                                                <div id="settingsLevelHigh" class="level-meter-fill"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Spectrum Analyzer</label>
                                    <canvas id="settingsSpectrumCanvas" width="300" height="100" style="width: 100%; max-width: 400px; background: rgba(0,0,0,0.2); border-radius: 8px;"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- UI Settings -->
                        <div class="settings-card">
                            <h3>üé® Benutzeroberfl√§che</h3>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showAudioPanelCheckbox" checked onchange="app.toggleAudioPanelVisibility()">
                                    <span>Audio Control Panel anzeigen</span>
                                </label>
                                <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
                                    Zeigt/versteckt das Audio-Panel unten rechts auf allen Seiten
                                </p>
                            </div>
                        </div>

                        <!-- App Info -->
                        <div class="settings-card">
                            <h3>‚ÑπÔ∏è App Information</h3>
                            <div class="info-row">
                                <span>Version:</span>
                                <strong>1.0.0</strong>
                            </div>
                            <div class="info-row">
                                <span>Platform:</span>
                                <strong id="platformInfo">Web</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="stageTab">
                <div class="stage-visualizer">
                    <!-- Controls Bar -->
                    <div class="stage-controls">
                        <div class="stage-control-group">
                            <label>Ansicht:</label>
                            <div class="button-group">
                                <button class="btn-option active" data-view="perspective" onclick="app.setStageView('perspective')">
                                    <span>üé≠ Perspektive</span>
                                </button>
                                <button class="btn-option" data-view="top" onclick="app.setStageView('top')">
                                    <span>‚¨áÔ∏è Draufsicht</span>
                                </button>
                                <button class="btn-option" data-view="front" onclick="app.setStageView('front')">
                                    <span>üëÅÔ∏è Frontal</span>
                                </button>
                                <button class="btn-option" data-view="3d" onclick="app.setStageView('3d')">
                                    <span>üé≤ 3D</span>
                                </button>
                            </div>
                        </div>

                        <div class="stage-control-group">
                            <label>Modus:</label>
                            <div class="button-group">
                                <button class="btn-option" id="stageDemoModeBtn" data-mode="demo" onclick="app.toggleStageDemoMode()">
                                    <span>üé™ Demo</span>
                                </button>
                                <button class="btn-option active" id="stageLiveModeBtn" data-mode="live" onclick="app.toggleStageDemoMode()">
                                    <span>üî¥ Live</span>
                                </button>
                            </div>
                        </div>

                        <div class="stage-control-group">
                            <label>Optionen:</label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="showBeamsCheckbox" checked onchange="app.toggleStageBeams()">
                                <span>Licht-Strahlen</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="showGridCheckbox" checked onchange="app.toggleStageGrid()">
                                <span>Raster</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="showLabelsCheckbox" checked onchange="app.toggleStageLabels()">
                                <span>Beschriftung</span>
                            </label>
                        </div>

                        <div class="stage-control-group">
                            <button class="btn btn-secondary btn-sm" onclick="app.resetStageCamera()">
                                <span>üì∑ Kamera zur√ºcksetzen</span>
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="app.showTrussManager()">
                                <span>üèóÔ∏è Traversen</span>
                            </button>
                            <button class="btn btn-secondary btn-sm" id="fullscreenBtn" onclick="app.toggleStageFullscreen()">
                                <span id="fullscreenIcon">‚õ∂</span> <span id="fullscreenText">Vollbild</span>
                            </button>
                        </div>
                    </div>

                    <!-- Stage Canvas -->
                    <div class="stage-canvas-container" id="stageCanvasContainer">
                        <canvas id="stageCanvas"></canvas>

                        <!-- Three.js 3D Container -->
                        <div id="stage3DContainer" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>

                        <!-- Stage Info Overlay -->
                        <div class="stage-info-overlay">
                            <div class="stage-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Spots aktiv:</span>
                                    <span class="stat-value" id="stageActiveSpots">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Gesamt-Leistung:</span>
                                    <span class="stat-value" id="stageTotalPower">0W</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">FPS:</span>
                                    <span class="stat-value" id="stageFPS">60</span>
                                </div>
                            </div>
                        </div>

                        <!-- Spot Details Popup (shown on hover) -->
                        <div class="spot-details-popup" id="spotDetailsPopup" style="display: none;">
                            <div class="spot-detail-header">
                                <strong id="spotDetailName">Spot 1</strong>
                            </div>
                            <div class="spot-detail-body">
                                <div class="spot-detail-row">
                                    <span>Position:</span>
                                    <span id="spotDetailPosition">X:0 Y:0 Z:0</span>
                                </div>
                                <div class="spot-detail-row">
                                    <span>Farbe:</span>
                                    <div class="spot-detail-color" id="spotDetailColor"></div>
                                </div>
                                <div class="spot-detail-row">
                                    <span>Intensit√§t:</span>
                                    <span id="spotDetailIntensity">0%</span>
                                </div>
                                <div class="spot-detail-row">
                                    <span>DMX:</span>
                                    <span id="spotDetailDMX">Ch 1-6</span>
                                </div>
                            </div>
                        </div>

                        <!-- Fullscreen Controls (auto-hide) -->
                        <div class="fullscreen-controls-overlay" id="fullscreenControlsOverlay" style="display: none;">
                            <div class="fullscreen-controls-bar">
                                <div class="fullscreen-title">B√ºhnen-Visualisierung</div>
                                <button class="btn-fullscreen-exit" id="btnFullscreenExit" onclick="app.toggleStageFullscreen()">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/>
                                    </svg>
                                    <span>Vollbild beenden</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="stage-legend">
                        <h4>Legende</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <div class="legend-icon spot-on"></div>
                                <span>Spot aktiv</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon spot-off"></div>
                                <span>Spot aus</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-icon spot-selected"></div>
                                <span>Ausgew√§hlt</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal: Ger√§t hinzuf√ºgen -->
    <div class="modal" id="addDeviceModal">
        <div class="modal-backdrop" onclick="app.closeModal('addDeviceModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Ger√§t hinzuf√ºgen</h2>
                <button class="modal-close" onclick="app.closeModal('addDeviceModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Fixture Library</label>
                    <select id="fixtureSelect" class="input" onchange="app.selectFixture()">
                        <option value="">-- Manuell konfigurieren --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ger√§tename</label>
                    <input type="text" id="deviceName" placeholder="z.B. B√ºhnenlicht Links" class="input">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>IP-Adresse</label>
                        <input type="text" id="deviceIp" placeholder="192.168.1.100" class="input">
                    </div>
                    <div class="form-group">
                        <label>Universe</label>
                        <input type="number" id="deviceUniverse" value="0" class="input">
                    </div>
                </div>
                <div class="form-group">
                    <label>Start-Kanal (1-512)</label>
                    <input type="number" id="deviceChannel" value="1" min="1" max="512" class="input">
                </div>
                <div class="form-group" id="manualTypeGroup">
                    <label>Ger√§tetyp</label>
                    <div class="button-group">
                        <button class="btn-option active" data-type="dimmer" onclick="app.selectDeviceType('dimmer')">Dimmer</button>
                        <button class="btn-option" data-type="rgb" onclick="app.selectDeviceType('rgb')">RGB</button>
                        <button class="btn-option" data-type="rgbw" onclick="app.selectDeviceType('rgbw')">RGBW</button>
                    </div>
                </div>
                <div class="form-group" id="fixtureInfo" style="display: none;">
                    <div class="info-message">
                        <strong id="fixtureInfoText"></strong>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addDeviceModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addDevice()">Hinzuf√ºgen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Art-Net Ger√§te scannen -->
    <div class="modal" id="artnetDiscoveryModal">
        <div class="modal-backdrop" onclick="app.closeArtNetDiscovery()"></div>
        <div class="modal-dialog" style="max-width: 800px;">
            <div class="modal-header">
                <h2>üîç Art-Net Ger√§te scannen</h2>
                <button class="modal-close" onclick="app.closeArtNetDiscovery()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="info-message">
                    <strong>‚ÑπÔ∏è Info:</strong> Das Netzwerk wird nach Art-Net-Ger√§ten durchsucht.
                    Stelle sicher, dass die Ger√§te eingeschaltet und im selben Netzwerk sind.
                </div>

                <div style="text-align: center; margin: 1.5rem 0;">
                    <button class="btn btn-primary" id="startScanBtn" onclick="app.startArtNetScan()">
                        <svg width="20" height="20" viewBox="0 0 20 20" style="margin-right: 0.5rem;">
                            <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                            <path d="M10 6 L10 10 L14 10" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        Scan starten
                    </button>
                </div>

                <div id="scanProgress" style="display: none; text-align: center; margin: 1.5rem 0;">
                    <div class="spinner" style="margin: 0 auto 1rem;"></div>
                    <p style="color: var(--text-secondary);">Scanne Netzwerk nach Art-Net-Ger√§ten...</p>
                </div>

                <div id="discoveredDevices" style="margin-top: 1.5rem;">
                    <!-- Discovered devices will be rendered here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeArtNetDiscovery()">Schlie√üen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Interface hinzuf√ºgen -->
    <div class="modal" id="addInterfaceModal">
        <div class="modal-backdrop" onclick="app.closeModal('addInterfaceModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Interface hinzuf√ºgen</h2>
                <button class="modal-close" onclick="app.closeModal('addInterfaceModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="interfaceName" class="input" placeholder="z.B. Art-Net Node 1">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>IP-Adresse</label>
                        <input type="text" id="interfaceIp" class="input" placeholder="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label>Port</label>
                        <input type="number" id="interfacePort" class="input" value="6454">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Universe</label>
                        <input type="number" id="interfaceUniverse" class="input" value="0" min="0" max="15">
                    </div>
                    <div class="form-group">
                        <label>Typ</label>
                        <select id="interfaceType" class="input">
                            <option value="artnet">Art-Net</option>
                            <option value="sacn">sACN</option>
                            <option value="dmx">DMX (USB)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Beschreibung (optional)</label>
                    <input type="text" id="interfaceDescription" class="input" placeholder="z.B. Hauptb√ºhne">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addInterfaceModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addInterface()">Hinzuf√ºgen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Gruppe hinzuf√ºgen -->
    <div class="modal" id="addGroupModal">
        <div class="modal-backdrop" onclick="app.closeModal('addGroupModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Gruppe erstellen</h2>
                <button class="modal-close" onclick="app.closeModal('addGroupModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Gruppenname</label>
                    <input type="text" id="groupName" placeholder="z.B. B√ºhnenlicht" class="input">
                </div>
                <div class="form-group">
                    <label>Ger√§te ausw√§hlen</label>
                    <div class="device-select" id="groupDeviceSelect">
                        <!-- Dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addGroupModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addGroup()">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Szene hinzuf√ºgen -->
    <div class="modal" id="addSceneModal">
        <div class="modal-backdrop" onclick="app.closeModal('addSceneModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Szene erstellen</h2>
                <button class="modal-close" onclick="app.closeModal('addSceneModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="info-message">
                    Aktuelle Ger√§tewerte werden als Szene gespeichert
                </div>
                <div class="form-group">
                    <label>Szenenname</label>
                    <input type="text" id="sceneName" placeholder="z.B. Gottesdienst, Konzert" class="input">
                </div>
                <div class="form-group">
                    <label>Farbe</label>
                    <div class="color-picker">
                        <button class="color-btn active" data-color="blue" onclick="app.selectSceneColor('blue')" style="background: #3b82f6"></button>
                        <button class="color-btn" data-color="green" onclick="app.selectSceneColor('green')" style="background: #10b981"></button>
                        <button class="color-btn" data-color="red" onclick="app.selectSceneColor('red')" style="background: #ef4444"></button>
                        <button class="color-btn" data-color="orange" onclick="app.selectSceneColor('orange')" style="background: #f59e0b"></button>
                        <button class="color-btn" data-color="purple" onclick="app.selectSceneColor('purple')" style="background: #8b5cf6"></button>
                        <button class="color-btn" data-color="pink" onclick="app.selectSceneColor('pink')" style="background: #ec4899"></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addSceneModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addScene()">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Effekt Editor (Visueller Editor) -->
    <div class="modal modal-large" id="effectEditorModal">
        <div class="modal-backdrop" onclick="app.closeEffectEditor()"></div>
        <div class="modal-dialog modal-effect-editor">
            <div class="modal-header">
                <h2 id="effectEditorTitle">Neuer Effekt</h2>
                <button class="modal-close" onclick="app.closeEffectEditor()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="effect-editor-layout">
                    <!-- Left Panel: Configuration -->
                    <div class="effect-editor-panel">
                        <div class="form-group">
                            <label>Effekt-Name</label>
                            <input type="text" id="effectEditorName" placeholder="Mein Effekt" class="input">
                        </div>

                        <div class="form-group">
                            <label>Effekt-Typ</label>
                            <select id="effectEditorType" class="input" onchange="app.updateEffectEditorParams()">
                                <option value="strobe">Stroboskop</option>
                                <option value="rainbow">Regenbogen</option>
                                <option value="chase">Lauflicht</option>
                                <option value="pulse">Pulsieren</option>
                                <option value="color_fade">Farbwechsel</option>
                                <option value="fire">üî• Feuer</option>
                                <option value="lightning">‚ö° Blitz</option>
                                <option value="scanner">üî¶ Scanner</option>
                                <option value="matrix">üìä Matrix</option>
                                <option value="twinkle">‚ú® Glitzer</option>
                                <option value="sound_reactive">Sound-Reaktiv</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Ziel ausw√§hlen</label>
                            <div class="target-selector">
                                <div class="button-group mb-2">
                                    <button class="btn-option active" data-target="devices" onclick="app.selectEffectTargetType('devices')">Ger√§te</button>
                                    <button class="btn-option" data-target="groups" onclick="app.selectEffectTargetType('groups')">Gruppen</button>
                                </div>
                                <div id="effectTargetDevices" class="target-select-container">
                                    <div class="device-select" id="effectDeviceSelect">
                                        <!-- Dynamisch gef√ºllt -->
                                    </div>
                                </div>
                                <div id="effectTargetGroups" class="target-select-container" style="display: none;">
                                    <div class="device-select" id="effectGroupSelect">
                                        <!-- Dynamisch gef√ºllt -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Parameters -->
                        <div id="effectEditorParams"></div>

                        <!-- Sound Reactivity -->
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="effectSoundReactive" onchange="app.toggleSoundReactive()">
                                <span>Sound-Reaktiv</span>
                            </label>
                        </div>

                        <div id="soundReactivityConfig" style="display: none;">
                            <div class="form-group">
                                <label>Frequenzbereich</label>
                                <select id="soundFrequencyBand" class="input">
                                    <option value="overall">Gesamter Pegel</option>
                                    <option value="bass">Bass (20-250 Hz)</option>
                                    <option value="mid">Mitten (250-2000 Hz)</option>
                                    <option value="high">H√∂hen (2000-20000 Hz)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Sound-Empfindlichkeit</label>
                                <input type="range" id="soundSensitivity" min="0" max="100" value="50" class="slider">
                                <div class="slider-value" id="soundSensitivityValue">50%</div>
                            </div>
                            <div class="form-group">
                                <label>Parameter f√ºr Sound-Steuerung</label>
                                <select id="soundControlParam" class="input">
                                    <option value="speed">Geschwindigkeit</option>
                                    <option value="intensity">Intensit√§t</option>
                                    <option value="both">Beides</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Preview -->
                    <div class="effect-editor-preview">
                        <h3>Vorschau</h3>
                        <div class="preview-container">
                            <canvas id="effectPreviewCanvas" width="300" height="200"></canvas>
                        </div>
                        <div class="preview-controls">
                            <button class="btn btn-secondary" onclick="app.previewEffect()">
                                <span>‚ñ∂</span> Vorschau
                            </button>
                            <button class="btn btn-secondary" onclick="app.stopPreviewEffect()">
                                <span>‚èπ</span> Stop
                            </button>
                        </div>

                        <!-- Sound Visualizer -->
                        <div id="soundVisualizer" style="display: none;">
                            <h4>Audio-Pegel</h4>
                            <canvas id="soundVisualizerCanvas" width="300" height="100"></canvas>
                            <div class="sound-levels">
                                <div class="level-bar">
                                    <span>Bass</span>
                                    <div class="level-bar-bg"><div id="levelBass" class="level-bar-fill"></div></div>
                                </div>
                                <div class="level-bar">
                                    <span>Mid</span>
                                    <div class="level-bar-bg"><div id="levelMid" class="level-bar-fill"></div></div>
                                </div>
                                <div class="level-bar">
                                    <span>High</span>
                                    <div class="level-bar-bg"><div id="levelHigh" class="level-bar-fill"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeEffectEditor()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveEffectFromEditor()">Speichern & Starten</button>
            </div>
        </div>
    </div>

    <!-- Modal: Sequence Editor -->
    <div class="modal modal-large" id="sequenceEditorModal">
        <div class="modal-backdrop" onclick="app.closeSequenceEditor()"></div>
        <div class="modal-dialog modal-sequence-editor">
            <div class="modal-header">
                <h2 id="sequenceEditorTitle">Neue Timeline</h2>
                <button class="modal-close" onclick="app.closeSequenceEditor()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Timeline-Name</label>
                    <input type="text" id="sequenceName" placeholder="z.B. Gottesdienst Ablauf" class="input">
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="sequenceLoop">
                        <span>Endlos wiederholen</span>
                    </label>
                </div>

                <div class="form-group">
                    <label>Steps</label>
                    <div class="sequence-steps" id="sequenceSteps">
                        <!-- Steps werden hier dynamisch eingef√ºgt -->
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="app.addSequenceStep('scene')">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Szene hinzuf√ºgen
                        </button>
                        <button class="btn btn-secondary" onclick="app.addSequenceStep('effect')">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Effekt hinzuf√ºgen
                        </button>
                        <button class="btn btn-secondary" onclick="app.addSequenceStep('wait')">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Pause hinzuf√ºgen
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeSequenceEditor()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveSequence()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Sound Control Panel -->
    <div class="sound-control-panel" id="soundControlPanel">
        <div class="sound-panel-header">
            <h3>üéµ Audio Control</h3>
            <button class="btn-icon" onclick="app.toggleSoundPanel()">+</button>
        </div>
        <div class="sound-panel-body" style="display: none;">
            <div class="sound-status">
                <span id="soundStatus">Inaktiv</span>
            </div>
            <button class="btn btn-primary btn-block" id="startSoundBtn" onclick="app.toggleSound()">
                üé§ Audio aktivieren
            </button>
            <div id="soundLevelsDisplay" style="display: none;">
                <div class="level-meter">
                    <div class="level-meter-bar">
                        <div id="soundLevelBar" class="level-meter-fill"></div>
                    </div>
                    <span id="soundLevelText">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Visual Effect Designer -->
    <div class="modal modal-large" id="visualDesignerModal">
        <div class="modal-backdrop" onclick="app.closeVisualDesigner()"></div>
        <div class="modal-dialog modal-visual-designer">
            <div class="modal-header">
                <h2>üé® Visual Effect Designer</h2>
                <button class="modal-close" onclick="app.closeVisualDesigner()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Effect Info -->
                <div class="designer-info-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Effekt-Name</label>
                            <input type="text" id="customEffectName" placeholder="Mein Custom Effekt" class="input">
                        </div>
                        <div class="form-group">
                            <label>Modus</label>
                            <div class="button-group">
                                <button class="btn-option active" data-mode="spot" onclick="app.setDesignerMode('spot')">
                                    <span>üí° Spots</span>
                                </button>
                                <button class="btn-option" data-mode="strip" onclick="app.setDesignerMode('strip')">
                                    <span>üåà LED Strips</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ger√§te ausw√§hlen</label>
                            <select id="customEffectDevices" class="input" multiple size="4">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Dauer (Sekunden)</label>
                            <input type="number" id="customEffectDuration" value="10" min="1" max="60" step="0.5" class="input">
                        </div>
                    </div>

                    <!-- Effect Preview -->
                    <div class="effect-preview-section">
                        <h4>üé¨ Effekt-Vorschau</h4>
                        <div class="effect-preview-container">
                            <canvas id="effectPreviewAnimCanvas" width="600" height="100"></canvas>
                        </div>
                        <div class="preview-controls-inline">
                            <button class="btn btn-secondary btn-sm" onclick="app.playEffectPreview()">
                                <span id="previewPlayIcon">‚ñ∂Ô∏è</span> <span>Vorschau</span>
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="app.stopEffectPreview()">
                                <span>‚èπ</span> <span>Stop</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="designer-timeline-section">
                    <div class="timeline-header">
                        <h3>Timeline</h3>
                        <button class="btn btn-secondary btn-sm" onclick="app.addKeyframe()">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Keyframe hinzuf√ºgen
                        </button>
                    </div>
                    <div class="timeline-container" id="designerTimeline">
                        <canvas id="timelineCanvas" height="120"></canvas>
                        <div class="timeline-scrubber" id="timelineScrubber"></div>
                    </div>
                    <div class="timeline-controls">
                        <button class="btn btn-icon" onclick="app.playPreview()">
                            <span id="playIcon">‚ñ∂Ô∏è</span>
                        </button>
                        <span id="timelineTime">0.0s</span>
                    </div>

                    <!-- Keyframe List -->
                    <div class="keyframe-list" id="keyframeList">
                        <h4>Keyframes</h4>
                        <div id="keyframeListItems" class="keyframe-list-items">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Keyframe Editor (Legacy - now using inline editors in list) -->
                <div class="designer-keyframe-section" id="keyframeEditor" style="display: none;">
                    <h3>Keyframe Einstellungen</h3>
                    <p style="color: var(--text-muted); font-size: 0.875rem;">Die Keyframe-Einstellungen werden jetzt direkt in der Liste bearbeitet. Klicke auf einen Keyframe in der Liste oben, um ihn zu erweitern und zu bearbeiten.</p>
                    <div id="keyframeEditorContent" style="display: none;">
                        <!-- Spot Mode -->
                        <div id="spotKeyframeEditor" style="display: none;">
                            <div class="form-group">
                                <label>Position (0-100%)</label>
                                <input type="range" id="kfPosition" min="0" max="100" value="0" class="input-range">
                                <span id="kfPositionValue">0%</span>
                            </div>
                            <div class="form-group">
                                <label>Farbe</label>
                                <div class="color-picker-group">
                                    <input type="color" id="kfColor" value="#ffffff" class="color-input">
                                    <div class="rgb-inputs">
                                        <input type="number" id="kfRed" min="0" max="255" value="255" placeholder="R" class="input input-sm">
                                        <input type="number" id="kfGreen" min="0" max="255" value="255" placeholder="G" class="input input-sm">
                                        <input type="number" id="kfBlue" min="0" max="255" value="255" placeholder="B" class="input input-sm">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Easing</label>
                                <select id="kfEasing" class="input">
                                    <option value="linear">Linear</option>
                                    <option value="ease-in">Ease In</option>
                                    <option value="ease-out">Ease Out</option>
                                    <option value="ease-in-out">Ease In-Out</option>
                                </select>
                            </div>
                        </div>

                        <!-- Strip Mode -->
                        <div id="stripKeyframeEditor" style="display: none;">
                            <div class="form-group">
                                <label>Position (0-100%)</label>
                                <input type="range" id="stripKfPosition" min="0" max="100" value="0" class="input-range">
                                <span id="stripKfPositionValue">0%</span>
                            </div>
                            <div class="form-group">
                                <label>Pattern-Typ</label>
                                <select id="stripPattern" class="input" onchange="app.updateStripPattern()">
                                    <option value="solid">Einfarbig</option>
                                    <option value="gradient">Gradient</option>
                                    <option value="wave">Welle</option>
                                    <option value="chase">Lauflicht</option>
                                </select>
                            </div>
                            <div id="stripPatternSettings">
                                <!-- Solid -->
                                <div id="solidSettings" class="pattern-settings">
                                    <div class="form-group">
                                        <label>Farbe</label>
                                        <input type="color" id="stripColor" value="#ffffff" class="color-input">
                                    </div>
                                </div>
                                <!-- Gradient -->
                                <div id="gradientSettings" class="pattern-settings" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Start-Farbe</label>
                                            <input type="color" id="gradientStart" value="#ff0000" class="color-input">
                                        </div>
                                        <div class="form-group">
                                            <label>End-Farbe</label>
                                            <input type="color" id="gradientEnd" value="#0000ff" class="color-input">
                                        </div>
                                    </div>
                                </div>
                                <!-- Wave -->
                                <div id="waveSettings" class="pattern-settings" style="display: none;">
                                    <div class="form-group">
                                        <label>Farbe</label>
                                        <input type="color" id="waveColor" value="#ffffff" class="color-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Wellenl√§nge</label>
                                        <input type="range" id="waveLength" min="3" max="30" value="10" class="input-range">
                                        <span id="waveLengthValue">10</span>
                                    </div>
                                    <div class="form-group">
                                        <label>Amplitude</label>
                                        <input type="range" id="waveAmplitude" min="0" max="255" value="255" class="input-range">
                                        <span id="waveAmplitudeValue">255</span>
                                    </div>
                                </div>
                                <!-- Chase -->
                                <div id="chaseSettings" class="pattern-settings" style="display: none;">
                                    <div class="form-group">
                                        <label>Farbe</label>
                                        <input type="color" id="chaseColor" value="#ffffff" class="color-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Breite</label>
                                        <input type="range" id="chaseWidth" min="1" max="10" value="3" class="input-range">
                                        <span id="chaseWidthValue">3</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="keyframe-actions">
                            <button class="btn btn-secondary" onclick="app.deleteCurrentKeyframe()">Keyframe l√∂schen</button>
                            <button class="btn btn-primary" onclick="app.saveCurrentKeyframe()">√úbernehmen</button>
                        </div>
                    </div>
                </div>

                <!-- Templates -->
                <div class="designer-templates-section">
                    <h3>Templates</h3>
                    <div class="template-buttons">
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('fade')">Fade</button>
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('pulse')">Puls</button>
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('colorCycle')">Farbwechsel</button>
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('strobe')">Stroboskop</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeVisualDesigner()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveCustomEffect()">Effekt erstellen</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Truss Manager Modal -->
    <div class="modal" id="trussManagerModal">
        <div class="modal-backdrop" onclick="app.closeTrussManager()"></div>
        <div class="modal-dialog truss-modal-content">
            <div class="modal-header">
                <h2>üèóÔ∏è Traversen-Verwaltung</h2>
                <button class="modal-close" onclick="app.closeTrussManager()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="truss-manager-grid">
                    <!-- Truss List -->
                    <div class="truss-section">
                        <div class="section-header">
                            <h3>Traversen</h3>
                            <button class="btn btn-primary btn-sm" onclick="app.showAddTruss()">
                                + Hinzuf√ºgen
                            </button>
                        </div>
                        <div id="trussList" class="truss-list-container">
                            <!-- Truss items will be rendered here -->
                        </div>
                    </div>

                    <!-- Spot Assignment -->
                    <div class="truss-section">
                        <h3>Spots zuordnen</h3>
                        <div id="spotAssignmentArea" class="spot-assignment-container">
                            <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">W√§hle eine Traverse aus, um Spots zuzuordnen</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Truss Modal -->
    <div class="modal" id="addTrussModal">
        <div class="modal-backdrop" onclick="app.closeAddTruss()"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2 id="trussModalTitle">Traverse hinzuf√ºgen</h2>
                <button class="modal-close" onclick="app.closeAddTruss()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="trussName" class="input" placeholder="z.B. Front Traverse">
                </div>

                <div class="form-section">
                    <h4>Position</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>X (Links/Rechts)</label>
                            <input type="number" id="trussX" class="input" value="0" step="0.5">
                        </div>
                        <div class="form-group">
                            <label>Y (H√∂he)</label>
                            <input type="number" id="trussY" class="input" value="4" step="0.5">
                        </div>
                        <div class="form-group">
                            <label>Z (Vorne/Hinten)</label>
                            <input type="number" id="trussZ" class="input" value="-4" step="0.5">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>Abmessungen</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>L√§nge (m)</label>
                            <input type="number" id="trussLength" class="input" value="10" step="0.5" min="1">
                        </div>
                        <div class="form-group">
                            <label>Rotation (¬∞)</label>
                            <input type="number" id="trussRotation" class="input" value="90" step="15" min="0" max="360">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeAddTruss()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveTruss()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Spot Configuration Modal -->
    <div class="modal" id="spotConfigModal">
        <div class="modal-backdrop" onclick="app.closeSpotConfig()"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2 id="spotConfigTitle">Spot konfigurieren</h2>
                <button class="modal-close" onclick="app.closeSpotConfig()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Position auf Traverse (m):</label>
                    <input type="range" id="spotTrussPosition" min="-5" max="5" step="0.1" value="0" oninput="app.updateSpotPositionPreview()">
                    <span id="spotTrussPositionValue">0 m</span>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Neigung (Tilt ¬∞):</label>
                        <input type="range" id="spotTilt" min="-90" max="90" step="5" value="-45" oninput="app.updateSpotTiltPreview()">
                        <span id="spotTiltValue">-45¬∞</span>
                    </div>
                    <div class="form-group">
                        <label>Drehung (Pan ¬∞):</label>
                        <input type="range" id="spotPan" min="-180" max="180" step="5" value="0" oninput="app.updateSpotPanPreview()">
                        <span id="spotPanValue">0¬∞</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Fokuspunkt (Ziel):</label>
                    <div class="form-row">
                        <input type="number" id="spotTargetX" placeholder="X" step="0.5" value="0">
                        <input type="number" id="spotTargetY" placeholder="Y" step="0.5" value="0">
                        <input type="number" id="spotTargetZ" placeholder="Z" step="0.5" value="0">
                        <button class="btn btn-secondary btn-sm" onclick="app.autoAimSpot()">Auto-Ausrichten</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeSpotConfig()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveSpotConfig()">Speichern</button>
            </div>
        </div>
    </div>

    <script src="audioAnalyzer.js"></script>
    <script src="app.js"></script>
</body>
</html>
