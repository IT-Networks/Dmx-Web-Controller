<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>DMX Web Controller Pro</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="app">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg width="32" height="32" viewBox="0 0 32 32">
                        <circle cx="16" cy="16" r="14" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 16 L16 12 L20 16 L16 20 Z" fill="currentColor"/>
                    </svg>
                    <span>DMX Pro</span>
                </div>
            </div>

            <div class="sidebar-menu">
                <button class="menu-item active" data-tab="devices" onclick="app.switchTab('devices')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <rect x="3" y="3" width="14" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="10" r="3" fill="currentColor"/>
                    </svg>
                    <span>Ger√§te</span>
                </button>

                <button class="menu-item" data-tab="groups" onclick="app.switchTab('groups')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <circle cx="7" cy="7" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="13" cy="7" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="14" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>Gruppen</span>
                </button>

                <button class="menu-item" data-tab="scenes" onclick="app.switchTab('scenes')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path d="M3 3 L17 3 L17 17 L3 17 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M7 3 L7 17 M12 3 L12 17 M3 7 L17 7 M3 12 L17 12" stroke="currentColor" stroke-width="1"/>
                    </svg>
                    <span>Szenen</span>
                </button>

                <button class="menu-item" data-tab="effects" onclick="app.switchTab('effects')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <path d="M10 3 L13 10 L10 17 L7 10 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="10" cy="10" r="2" fill="currentColor"/>
                    </svg>
                    <span>Effekte</span>
                </button>

                <button class="menu-item" data-tab="sequences" onclick="app.switchTab('sequences')">
                    <svg width="20" height="20" viewBox="0 0 20 20">
                        <rect x="2" y="7" width="4" height="6" fill="currentColor"/>
                        <rect x="8" y="4" width="4" height="12" fill="currentColor"/>
                        <rect x="14" y="6" width="4" height="8" fill="currentColor"/>
                    </svg>
                    <span>Timeline</span>
                </button>
            </div>

            <div class="sidebar-footer">
                <div class="connection-status" id="connectionStatus">
                    <div class="status-indicator"></div>
                    <span>Verbunden</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-title">
                    <h1 id="pageTitle">Ger√§te</h1>
                    <p id="pageSubtitle">Verwalte deine DMX-Ger√§te</p>
                </div>
                <div class="header-actions" id="headerActions">
                    <button class="btn btn-primary" id="addButton" onclick="app.showAddDevice()">
                        <svg width="20" height="20" viewBox="0 0 20 20">
                            <path d="M10 3 L10 17 M3 10 L17 10" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <span>Ger√§t hinzuf√ºgen</span>
                    </button>
                </div>
            </header>

            <!-- Tab Contents -->
            <div class="tab-content active" id="devicesTab">
                <div class="content-grid" id="devicesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <circle cx="32" cy="32" r="28" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Ger√§te vorhanden</h3>
                        <p>F√ºge dein erstes DMX-Ger√§t hinzu</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="groupsTab">
                <div class="content-grid" id="groupsContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <circle cx="24" cy="24" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="40" cy="24" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <circle cx="32" cy="44" r="10" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Gruppen vorhanden</h3>
                        <p>Erstelle eine Gruppe aus mehreren Ger√§ten</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="scenesTab">
                <div class="content-grid scenes-grid" id="scenesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <rect x="12" y="12" width="40" height="40" rx="4" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Szenen vorhanden</h3>
                        <p>Speichere die aktuelle Lichtstimmung als Szene</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="effectsTab">
                <div class="effects-layout">
                    <div class="effects-list" id="effectsContainer">
                        <div class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 64 64">
                                <path d="M32 12 L40 32 L32 52 L24 32 Z" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            </svg>
                            <h3>Keine Effekte vorhanden</h3>
                            <p>Erstelle deinen ersten Lichteffekt</p>
                        </div>
                    </div>
                    <div class="effects-sidebar">
                        <h3>Verf√ºgbare Effekte</h3>
                        <div class="effect-templates">
                            <button class="effect-template" onclick="app.createEffect('strobe')">
                                <span class="effect-icon">‚ö°</span>
                                <span>Stroboskop</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('rainbow')">
                                <span class="effect-icon">üåà</span>
                                <span>Regenbogen</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('chase')">
                                <span class="effect-icon">üîÑ</span>
                                <span>Lauflicht</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('pulse')">
                                <span class="effect-icon">üíì</span>
                                <span>Pulsieren</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('color_fade')">
                                <span class="effect-icon">üé®</span>
                                <span>Farbwechsel</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('fire')">
                                <span class="effect-icon">üî•</span>
                                <span>Feuer</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('lightning')">
                                <span class="effect-icon">‚ö°Ô∏è</span>
                                <span>Blitz</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('scanner')">
                                <span class="effect-icon">üî¶</span>
                                <span>Scanner</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('matrix')">
                                <span class="effect-icon">üìä</span>
                                <span>Matrix</span>
                            </button>
                            <button class="effect-template" onclick="app.createEffect('twinkle')">
                                <span class="effect-icon">‚ú®</span>
                                <span>Glitzer</span>
                            </button>
                            <button class="effect-template effect-template-custom" onclick="app.openVisualDesigner()">
                                <span class="effect-icon">üé®</span>
                                <span>Custom Designer</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="sequencesTab">
                <div class="content-grid" id="sequencesContainer">
                    <div class="empty-state">
                        <svg width="64" height="64" viewBox="0 0 64 64">
                            <rect x="8" y="24" width="12" height="16" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <rect x="26" y="16" width="12" height="32" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                            <rect x="44" y="20" width="12" height="24" fill="none" stroke="currentColor" stroke-width="2" opacity="0.3"/>
                        </svg>
                        <h3>Keine Timeline vorhanden</h3>
                        <p>Erstelle eine Timeline-Sequence f√ºr automatisierte Abl√§ufe</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal: Ger√§t hinzuf√ºgen -->
    <div class="modal" id="addDeviceModal">
        <div class="modal-backdrop" onclick="app.closeModal('addDeviceModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Ger√§t hinzuf√ºgen</h2>
                <button class="modal-close" onclick="app.closeModal('addDeviceModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Fixture Library</label>
                    <select id="fixtureSelect" class="input" onchange="app.selectFixture()">
                        <option value="">-- Manuell konfigurieren --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ger√§tename</label>
                    <input type="text" id="deviceName" placeholder="z.B. B√ºhnenlicht Links" class="input">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>IP-Adresse</label>
                        <input type="text" id="deviceIp" placeholder="192.168.1.100" class="input">
                    </div>
                    <div class="form-group">
                        <label>Universe</label>
                        <input type="number" id="deviceUniverse" value="0" class="input">
                    </div>
                </div>
                <div class="form-group">
                    <label>Start-Kanal (1-512)</label>
                    <input type="number" id="deviceChannel" value="1" min="1" max="512" class="input">
                </div>
                <div class="form-group" id="manualTypeGroup">
                    <label>Ger√§tetyp</label>
                    <div class="button-group">
                        <button class="btn-option active" data-type="dimmer" onclick="app.selectDeviceType('dimmer')">Dimmer</button>
                        <button class="btn-option" data-type="rgb" onclick="app.selectDeviceType('rgb')">RGB</button>
                        <button class="btn-option" data-type="rgbw" onclick="app.selectDeviceType('rgbw')">RGBW</button>
                    </div>
                </div>
                <div class="form-group" id="fixtureInfo" style="display: none;">
                    <div class="info-message">
                        <strong id="fixtureInfoText"></strong>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addDeviceModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addDevice()">Hinzuf√ºgen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Gruppe hinzuf√ºgen -->
    <div class="modal" id="addGroupModal">
        <div class="modal-backdrop" onclick="app.closeModal('addGroupModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Gruppe erstellen</h2>
                <button class="modal-close" onclick="app.closeModal('addGroupModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Gruppenname</label>
                    <input type="text" id="groupName" placeholder="z.B. B√ºhnenlicht" class="input">
                </div>
                <div class="form-group">
                    <label>Ger√§te ausw√§hlen</label>
                    <div class="device-select" id="groupDeviceSelect">
                        <!-- Dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addGroupModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addGroup()">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Szene hinzuf√ºgen -->
    <div class="modal" id="addSceneModal">
        <div class="modal-backdrop" onclick="app.closeModal('addSceneModal')"></div>
        <div class="modal-dialog">
            <div class="modal-header">
                <h2>Szene erstellen</h2>
                <button class="modal-close" onclick="app.closeModal('addSceneModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="info-message">
                    Aktuelle Ger√§tewerte werden als Szene gespeichert
                </div>
                <div class="form-group">
                    <label>Szenenname</label>
                    <input type="text" id="sceneName" placeholder="z.B. Gottesdienst, Konzert" class="input">
                </div>
                <div class="form-group">
                    <label>Farbe</label>
                    <div class="color-picker">
                        <button class="color-btn active" data-color="blue" onclick="app.selectSceneColor('blue')" style="background: #3b82f6"></button>
                        <button class="color-btn" data-color="green" onclick="app.selectSceneColor('green')" style="background: #10b981"></button>
                        <button class="color-btn" data-color="red" onclick="app.selectSceneColor('red')" style="background: #ef4444"></button>
                        <button class="color-btn" data-color="orange" onclick="app.selectSceneColor('orange')" style="background: #f59e0b"></button>
                        <button class="color-btn" data-color="purple" onclick="app.selectSceneColor('purple')" style="background: #8b5cf6"></button>
                        <button class="color-btn" data-color="pink" onclick="app.selectSceneColor('pink')" style="background: #ec4899"></button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('addSceneModal')">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.addScene()">Erstellen</button>
            </div>
        </div>
    </div>

    <!-- Modal: Effekt Editor (Visueller Editor) -->
    <div class="modal modal-large" id="effectEditorModal">
        <div class="modal-backdrop" onclick="app.closeEffectEditor()"></div>
        <div class="modal-dialog modal-effect-editor">
            <div class="modal-header">
                <h2 id="effectEditorTitle">Neuer Effekt</h2>
                <button class="modal-close" onclick="app.closeEffectEditor()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="effect-editor-layout">
                    <!-- Left Panel: Configuration -->
                    <div class="effect-editor-panel">
                        <div class="form-group">
                            <label>Effekt-Name</label>
                            <input type="text" id="effectEditorName" placeholder="Mein Effekt" class="input">
                        </div>

                        <div class="form-group">
                            <label>Effekt-Typ</label>
                            <select id="effectEditorType" class="input" onchange="app.updateEffectEditorParams()">
                                <option value="strobe">Stroboskop</option>
                                <option value="rainbow">Regenbogen</option>
                                <option value="chase">Lauflicht</option>
                                <option value="pulse">Pulsieren</option>
                                <option value="color_fade">Farbwechsel</option>
                                <option value="fire">üî• Feuer</option>
                                <option value="lightning">‚ö° Blitz</option>
                                <option value="scanner">üî¶ Scanner</option>
                                <option value="matrix">üìä Matrix</option>
                                <option value="twinkle">‚ú® Glitzer</option>
                                <option value="sound_reactive">Sound-Reaktiv</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Ziel ausw√§hlen</label>
                            <div class="target-selector">
                                <div class="button-group mb-2">
                                    <button class="btn-option active" data-target="devices" onclick="app.selectEffectTargetType('devices')">Ger√§te</button>
                                    <button class="btn-option" data-target="groups" onclick="app.selectEffectTargetType('groups')">Gruppen</button>
                                </div>
                                <div id="effectTargetDevices" class="target-select-container">
                                    <div class="device-select" id="effectDeviceSelect">
                                        <!-- Dynamisch gef√ºllt -->
                                    </div>
                                </div>
                                <div id="effectTargetGroups" class="target-select-container" style="display: none;">
                                    <div class="device-select" id="effectGroupSelect">
                                        <!-- Dynamisch gef√ºllt -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic Parameters -->
                        <div id="effectEditorParams"></div>

                        <!-- Sound Reactivity -->
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="effectSoundReactive" onchange="app.toggleSoundReactive()">
                                <span>Sound-Reaktiv</span>
                            </label>
                        </div>

                        <div id="soundReactivityConfig" style="display: none;">
                            <div class="form-group">
                                <label>Frequenzbereich</label>
                                <select id="soundFrequencyBand" class="input">
                                    <option value="overall">Gesamter Pegel</option>
                                    <option value="bass">Bass (20-250 Hz)</option>
                                    <option value="mid">Mitten (250-2000 Hz)</option>
                                    <option value="high">H√∂hen (2000-20000 Hz)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Sound-Empfindlichkeit</label>
                                <input type="range" id="soundSensitivity" min="0" max="100" value="50" class="slider">
                                <div class="slider-value" id="soundSensitivityValue">50%</div>
                            </div>
                            <div class="form-group">
                                <label>Parameter f√ºr Sound-Steuerung</label>
                                <select id="soundControlParam" class="input">
                                    <option value="speed">Geschwindigkeit</option>
                                    <option value="intensity">Intensit√§t</option>
                                    <option value="both">Beides</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Preview -->
                    <div class="effect-editor-preview">
                        <h3>Vorschau</h3>
                        <div class="preview-container">
                            <canvas id="effectPreviewCanvas" width="300" height="200"></canvas>
                        </div>
                        <div class="preview-controls">
                            <button class="btn btn-secondary" onclick="app.previewEffect()">
                                <span>‚ñ∂</span> Vorschau
                            </button>
                            <button class="btn btn-secondary" onclick="app.stopPreviewEffect()">
                                <span>‚èπ</span> Stop
                            </button>
                        </div>

                        <!-- Sound Visualizer -->
                        <div id="soundVisualizer" style="display: none;">
                            <h4>Audio-Pegel</h4>
                            <canvas id="soundVisualizerCanvas" width="300" height="100"></canvas>
                            <div class="sound-levels">
                                <div class="level-bar">
                                    <span>Bass</span>
                                    <div class="level-bar-bg"><div id="levelBass" class="level-bar-fill"></div></div>
                                </div>
                                <div class="level-bar">
                                    <span>Mid</span>
                                    <div class="level-bar-bg"><div id="levelMid" class="level-bar-fill"></div></div>
                                </div>
                                <div class="level-bar">
                                    <span>High</span>
                                    <div class="level-bar-bg"><div id="levelHigh" class="level-bar-fill"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeEffectEditor()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveEffectFromEditor()">Speichern & Starten</button>
            </div>
        </div>
    </div>

    <!-- Modal: Sequence Editor -->
    <div class="modal modal-large" id="sequenceEditorModal">
        <div class="modal-backdrop" onclick="app.closeSequenceEditor()"></div>
        <div class="modal-dialog modal-sequence-editor">
            <div class="modal-header">
                <h2 id="sequenceEditorTitle">Neue Timeline</h2>
                <button class="modal-close" onclick="app.closeSequenceEditor()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Timeline-Name</label>
                    <input type="text" id="sequenceName" placeholder="z.B. Gottesdienst Ablauf" class="input">
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="sequenceLoop">
                        <span>Endlos wiederholen</span>
                    </label>
                </div>

                <div class="form-group">
                    <label>Steps</label>
                    <div class="sequence-steps" id="sequenceSteps">
                        <!-- Steps werden hier dynamisch eingef√ºgt -->
                    </div>
                    <div class="step-actions">
                        <button class="btn btn-secondary" onclick="app.addSequenceStep('scene')">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Szene hinzuf√ºgen
                        </button>
                        <button class="btn btn-secondary" onclick="app.addSequenceStep('effect')">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Effekt hinzuf√ºgen
                        </button>
                        <button class="btn btn-secondary" onclick="app.addSequenceStep('wait')">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Pause hinzuf√ºgen
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeSequenceEditor()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveSequence()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Sound Control Panel -->
    <div class="sound-control-panel" id="soundControlPanel">
        <div class="sound-panel-header">
            <h3>üéµ Audio Control</h3>
            <button class="btn-icon" onclick="app.toggleSoundPanel()">‚àí</button>
        </div>
        <div class="sound-panel-body">
            <div class="sound-status">
                <span id="soundStatus">Inaktiv</span>
            </div>
            <button class="btn btn-primary btn-block" id="startSoundBtn" onclick="app.toggleSound()">
                üé§ Audio aktivieren
            </button>
            <div id="soundLevelsDisplay" style="display: none;">
                <div class="level-meter">
                    <div class="level-meter-bar">
                        <div id="soundLevelBar" class="level-meter-fill"></div>
                    </div>
                    <span id="soundLevelText">0%</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Visual Effect Designer -->
    <div class="modal modal-large" id="visualDesignerModal">
        <div class="modal-backdrop" onclick="app.closeVisualDesigner()"></div>
        <div class="modal-dialog modal-visual-designer">
            <div class="modal-header">
                <h2>üé® Visual Effect Designer</h2>
                <button class="modal-close" onclick="app.closeVisualDesigner()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Effect Info -->
                <div class="designer-info-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Effekt-Name</label>
                            <input type="text" id="customEffectName" placeholder="Mein Custom Effekt" class="input">
                        </div>
                        <div class="form-group">
                            <label>Modus</label>
                            <div class="button-group">
                                <button class="btn-option active" data-mode="spot" onclick="app.setDesignerMode('spot')">
                                    <span>üí° Spots</span>
                                </button>
                                <button class="btn-option" data-mode="strip" onclick="app.setDesignerMode('strip')">
                                    <span>üåà LED Strips</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ger√§te ausw√§hlen</label>
                            <select id="customEffectDevices" class="input" multiple size="4">
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Dauer (Sekunden)</label>
                            <input type="number" id="customEffectDuration" value="10" min="1" max="60" step="0.5" class="input">
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="designer-timeline-section">
                    <div class="timeline-header">
                        <h3>Timeline</h3>
                        <button class="btn btn-secondary btn-sm" onclick="app.addKeyframe()">
                            <svg width="16" height="16" viewBox="0 0 16 16">
                                <path d="M8 2 L8 14 M2 8 L14 8" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Keyframe hinzuf√ºgen
                        </button>
                    </div>
                    <div class="timeline-container" id="designerTimeline">
                        <canvas id="timelineCanvas" width="800" height="120"></canvas>
                        <div class="timeline-scrubber" id="timelineScrubber"></div>
                    </div>
                    <div class="timeline-controls">
                        <button class="btn btn-icon" onclick="app.playPreview()">
                            <span id="playIcon">‚ñ∂Ô∏è</span>
                        </button>
                        <span id="timelineTime">0.0s</span>
                    </div>
                </div>

                <!-- Keyframe Editor -->
                <div class="designer-keyframe-section" id="keyframeEditor" style="display: none;">
                    <h3>Keyframe Einstellungen</h3>
                    <div id="keyframeEditorContent">
                        <!-- Spot Mode -->
                        <div id="spotKeyframeEditor" style="display: none;">
                            <div class="form-group">
                                <label>Position (0-100%)</label>
                                <input type="range" id="kfPosition" min="0" max="100" value="0" class="input-range">
                                <span id="kfPositionValue">0%</span>
                            </div>
                            <div class="form-group">
                                <label>Farbe</label>
                                <div class="color-picker-group">
                                    <input type="color" id="kfColor" value="#ffffff" class="color-input">
                                    <div class="rgb-inputs">
                                        <input type="number" id="kfRed" min="0" max="255" value="255" placeholder="R" class="input input-sm">
                                        <input type="number" id="kfGreen" min="0" max="255" value="255" placeholder="G" class="input input-sm">
                                        <input type="number" id="kfBlue" min="0" max="255" value="255" placeholder="B" class="input input-sm">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Easing</label>
                                <select id="kfEasing" class="input">
                                    <option value="linear">Linear</option>
                                    <option value="ease-in">Ease In</option>
                                    <option value="ease-out">Ease Out</option>
                                    <option value="ease-in-out">Ease In-Out</option>
                                </select>
                            </div>
                        </div>

                        <!-- Strip Mode -->
                        <div id="stripKeyframeEditor" style="display: none;">
                            <div class="form-group">
                                <label>Position (0-100%)</label>
                                <input type="range" id="stripKfPosition" min="0" max="100" value="0" class="input-range">
                                <span id="stripKfPositionValue">0%</span>
                            </div>
                            <div class="form-group">
                                <label>Pattern-Typ</label>
                                <select id="stripPattern" class="input" onchange="app.updateStripPattern()">
                                    <option value="solid">Einfarbig</option>
                                    <option value="gradient">Gradient</option>
                                    <option value="wave">Welle</option>
                                    <option value="chase">Lauflicht</option>
                                </select>
                            </div>
                            <div id="stripPatternSettings">
                                <!-- Solid -->
                                <div id="solidSettings" class="pattern-settings">
                                    <div class="form-group">
                                        <label>Farbe</label>
                                        <input type="color" id="stripColor" value="#ffffff" class="color-input">
                                    </div>
                                </div>
                                <!-- Gradient -->
                                <div id="gradientSettings" class="pattern-settings" style="display: none;">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Start-Farbe</label>
                                            <input type="color" id="gradientStart" value="#ff0000" class="color-input">
                                        </div>
                                        <div class="form-group">
                                            <label>End-Farbe</label>
                                            <input type="color" id="gradientEnd" value="#0000ff" class="color-input">
                                        </div>
                                    </div>
                                </div>
                                <!-- Wave -->
                                <div id="waveSettings" class="pattern-settings" style="display: none;">
                                    <div class="form-group">
                                        <label>Farbe</label>
                                        <input type="color" id="waveColor" value="#ffffff" class="color-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Wellenl√§nge</label>
                                        <input type="range" id="waveLength" min="3" max="30" value="10" class="input-range">
                                        <span id="waveLengthValue">10</span>
                                    </div>
                                    <div class="form-group">
                                        <label>Amplitude</label>
                                        <input type="range" id="waveAmplitude" min="0" max="255" value="255" class="input-range">
                                        <span id="waveAmplitudeValue">255</span>
                                    </div>
                                </div>
                                <!-- Chase -->
                                <div id="chaseSettings" class="pattern-settings" style="display: none;">
                                    <div class="form-group">
                                        <label>Farbe</label>
                                        <input type="color" id="chaseColor" value="#ffffff" class="color-input">
                                    </div>
                                    <div class="form-group">
                                        <label>Breite</label>
                                        <input type="range" id="chaseWidth" min="1" max="10" value="3" class="input-range">
                                        <span id="chaseWidthValue">3</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="keyframe-actions">
                            <button class="btn btn-secondary" onclick="app.deleteCurrentKeyframe()">Keyframe l√∂schen</button>
                            <button class="btn btn-primary" onclick="app.saveCurrentKeyframe()">√úbernehmen</button>
                        </div>
                    </div>
                </div>

                <!-- Templates -->
                <div class="designer-templates-section">
                    <h3>Templates</h3>
                    <div class="template-buttons">
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('fade')">Fade</button>
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('pulse')">Puls</button>
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('colorCycle')">Farbwechsel</button>
                        <button class="btn btn-secondary btn-sm" onclick="app.loadTemplate('strobe')">Stroboskop</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeVisualDesigner()">Abbrechen</button>
                <button class="btn btn-primary" onclick="app.saveCustomEffect()">Effekt erstellen</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="./audioAnalyzer.js"></script>
    <script src="./app.js"></script>
</body>
</html>
